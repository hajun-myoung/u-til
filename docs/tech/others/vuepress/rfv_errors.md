# 몇 가지 오류와 대처방법

뷰프레스 프레임워크를 사용하여 블로그를 작성하면서, 맞닥뜨렸던 오류들을 적은 문서에요.  
다음의 것들을 신경쓰려고 했어요:
- 오류가 발생된 상황
- 원인
- 해결방법

부디, 당신이 겪고 있는 '알 수 없는 오류'가 이 문서에서 해결된 것이기를 바랄게요. :fist:
:::tip 제보를 기다립니다.
제가 겪지 못한 오류들과 해결한 방법을 제보해주세요.  
아주 사소한 오류도 좋고, 심각한 오류도 좋아요.  
해결방법을 찾으셨다면 베스트, 해결방법이 아직 찾아지지 않았어도 일단 제보해주세요.

메일제목은 [until][오류제보] 정도로 시작해주시면 찾기 편할 것 같아요.
:::

## 파워쉘 보안 문제

### 오류 상황
저는 cmd 대신 파워쉘로 npm, yarn 등을 설치하고 작업했어요.  
yarn 설치까지는 성공했는데, 설치 확인을 위해 `yarn -version`을 명령하니,

```sh
yarn : 이 시스템에서 스크립트를 실행할 수 없으므로
C:\Users\Administrator\AppData\Roaming\npm\yarn.ps1 파일을 로드할 수 없습니다.
자세한 내용은 about_Execution_Policies(https://go.microsoft.com/fwlink/?LinkID=135170)
를 참조하십시오.

위치 줄:1 문자:1 + yarn -v + ~~~~ + CategoryInfo
: 보안 오류: (:) [], PSSecurityException + FullyQualifiedErrorId : UnauthorizedAccess
```

이런 오류가 뜨는거에요. 어떻게 해야 하나...하다가 [확장형 뇌 저장소님의 글](https://extbrain.tistory.com/118)을 따라해 해결했답니다.

### 원인

핵심은, **파워쉘에서 보안 문제로 yarn이 무언가를 실행할 수 없게 막은 것** 이었어요.

### 해결

---

1. 먼저, 파워쉘을 **관리자 권한** 으로 실행해 줍니다.
1. 다음의 명령어를 입력해, 파워쉘 정책이 yarn을 제한시키는지 아닌지 알아봅니다.

```sh
$ ExecutionPolicy
```

(대소문자는 중요하지 않아요)

- 아래 그림처럼 'Restricted'라고 뜨면, 보안 정책 문제가 맞습니다.  
  <img :src="$withBase('/images/vuepress/ps_001.png')" alt="restricted">

3. 이제 보안 정책을 풀어줍니다.

```sh
$ Set-ExecutionPolicy unRestricted
```

중간에 정말 변경할 건지 묻는 질문에 'y'로 동의해주시는 거 잊지 말구요.  
<img :src="$withBase('/images/vuepress/ps_002.png')" alt="settingPs">

4. 자, 정말 변경되었는지 확인해봅니다.

```sh
$ ExecutionPolicy
```

<img :src="$withBase('/images/vuepress/ps_003.png')" alt="compleps">

다 하셨다면, `yarn -version`을 명령해 문제가 해결되었는지 확인해보세요.

## 베이스 루트 문제
이 문제의 경우, `dev` 명령은 정상적이고, `build`는 의도대로 일하지 않아요.

### 문제 상황

`yarn dev` 명령에서는 문제 없이 의도한 페이지가 구성되는데 `yarn build`에서는 레이아웃이 완전히 깨진(기본 테마가 전혀 적용되지 않은) 결과물이 출력됩니다. 제 경우, 세 개의 검정 사각형이 반기는 페이지가 구성되었어요.

<img :src="$withBase('images/vuepress/onlyThreeRectangle.png')" alt="rayoutCrashed">

해당 페이지가 빌드 실패가 아닌 '레이아웃의 깨짐'이라고 판단한 건, 페이지를 이루고 있는 내용들은 작성한 내용 그대로 출력되었기 때문입니다. 그러나 기본 테마도, 내용 정리도 이루어지지 않은 raw한 html 파일의 모습을 하고있어요.

### 원인
뷰프레스 블로그를 구성하다보면, config 파일에 `base=`를 지정하는 파트가 있어요.  
베이스는 '여러분의 블로그가 시작되는 기반 주소'를 의미하고, 제 블로그의 경우 `/until/` 이 여기에 해당되죠. **이 베이스 주소는, 레포지토리 이름과 일치하거나 없어야 한다는 점 주의하시기 바랍니다.**  
:::: code-group
::: code-group-item 베이스 O
```js
base='/until/'
```
:::
::: code-group-item 베이스 X
```js
base='/'
```
:::
::::
:::tip 베이스가 없는 경우와 있는 경우의 차이
없다면 <username\>.github.io/ 에 블로그가 디플로잉 되고,  
베이스를 지정했다면 <username\>.github.io/<base\>/에 블로그가 디플로잉이 이루어집니다.
:::

### 해결

---

해결법을 찾아 헤메이며 스트레스 받았지만, 의외로 간단하게 해결되었습니다. :grimacing:  
config.js 파일에 있는 베이스 코드가

```js
module.exports={
    base : '/studyb/',
    ~~~
   }
```

라고 되어있는데, (당시 레포지토리 이름은 studyB)  
이를 아래와 같이 수정하고 나서야, 제대로 된 페이지를 배포할 수 있었어요.

```js
module.exports={
    base : '/studyB/',
    ~~~
   }
```

네 맞아요. 베이스 코드는 무려 대소문자를 구분하더라구요.  
:::tip 이 오류를 해결하면서
아, 이래서 레포지토리 이름에 대문자를 쓰지 말라고 하는구나...하고  
깨달으며 레포지토리 이름을 'study_b'로 바꾸게 되었죠.
:::
:::details 이 블로그의 이름은 study_b가 아니라 until 아닌가요?
아 죄송해요, 혼선을 드렸네요. study_b는 이전 vuepress 1 framework를 이용할 당시의 블로그 이름이에요. 지금은 vuepress 2 framework를 이용중이구요.
:::

### 참고할만한 것
뷰프레스 테마가 적용되지 않고 세 개의 검은 사각형으로 페이지가 시작되는 오류는 다양한 원인을 가지고 있어요. 여기서 서술한 원인도, 여러가지 경우 중 하나일 뿐이죠. vuejs 공식 깃허브에서도 ['Three black rectangle' 이 나온다는 이슈](https://github.com/vuejs/vuepress/issues/575)가 꽤 흔해요ㅋㅋ

> 참고로, 저 링크에 있는 이슈는 이 오류를 해결하는 데 아무런 도움이 되지 않았습니다 :grimacing:

## 플러그인 적용 실패 문제

:::warning vuepress 1 framework에서 발생했던 문제에요.
vuepress 2 framework 부터는 기본적으로 제공되는 기능이에요.
:::

### 문제
블로그를 작성하면서, 몇 가지 플러그인을 넣으려고 시도 해 보았지만 제대로 되지 않았어요.  
- **문제가 발생한 플러그인:** "back-to-top"
- **역할:** 화면 우하단에 페이지 꼭대기로 갈 수 있는 버튼을 제공

이 플러그인은 뷰프레스 공식 플러그인이어서, [가이드가 친절하게 제공되어](https://vuepress.vuejs.org/plugin/official/plugin-back-to-top.html#vuepress-plugin-back-to-top) 있어요.  
그다지 어려운 가이드가 아닌데도, back-to-top 버튼은 절대 생기지를 않더라구요... :sob:

### 해결

---

이 오류의 문제점은 '구글 애널리틱스'를 적용하고자 하면서 찾게 되었어요. 굉장히 허무한 원인이었죠.

뷰프레스 블로그에서의 플러그인은 **1)npm install이나 yarn add를 통해 필요한 파일을 설치(install)** 하고, **2)`config.js` 파일의 수정을 통해서 이를 적용**하는 두 단계를 거쳐서 설치하는 게 일반적이에요.

제 경우, 플러그인 '설치'는 성공적이었어요. 문제점은 `config.js`의 수정에서 발견되었죠.

플러그인들을 적용할 때 `config.js`의 구성은 다음과 같아야 해요:

```js
module.exports={
   //some codes...
   plugins=[
      'Name-of-Plugin',
      [
         'some-plugins-have-children',
         {
            //like this
            'ga' : 'UA-00000000-0'
         }
      ]
   ]
   //some codes...
}
```

하지만, 제 `config.js`를 유심히 살펴보니, 이것저것 셋팅한다고 하다가 어처구니 없는 실수를 했더군요.

```js{7-11}
module.exports={
   base : '/study_b/',
   locales : {
      //...
   },
   //...
   themeConfig:{
      plugins=[
         ...
      ]
   }
   //...
}
```

**맞아요, 놀랍게도 `plugins=[]`를 `themeConfig:{}` 안에 넣어버렸어요.**

...그리고 그걸 꺼내줬더니 짜잔! 해결되었답니다~...ㅎ

## 특정 파일 추가하기
특정 파일을 추가한다는 건, 오류에 대한 대처보다는 '새로운 배움'에 가깝죠. 생각보다 쉬운 내용이고, 정말 쓸 수 있는 곳이 많아요. 크게 몇 가지만 살펴보아도

1. 구글 서치 콘솔 소유권 증명을 위한 .html 파일을 쓸 수 있어요
   - 상당히 복잡한, \<gtag.js> 를 통한 소유권 증명 방식을 안 써도 된다는 의미에요!
1. 사이트맵을 수동으로 작성하고, 매번 같은 위치에 포함되게끔 설정할 수 있어요.
1. 404.html 처럼 특정한 목적을 가진 페이지를 임의로 포함시킬 수 있어요.
1. 예시로 들기 위한 파일을 임의로 넣을 수 있어요.
   - 뷰프레스가 지원하지 않는 파일이더라도 일단 넣고, 링크를 걸면 연결시킬 수 있겠죠.

### 상황 및 가정
- 상황
   - 블로그 베이스 루트 주소(~/until/)에 `src.file` 이라는 파일이 있다고 할게요.
   - 이 파일을 매번 블로그를 deploying할 때 `~/until/target/`에 포함시키고 싶어요.

- 가정
   - 앞으로 설명할 방법은 쉘 명령을 이용한 방법이에요.
   - 따라서, `deploy.sh`파일을 이용한 반자동 deploying을 쓰시는 분들이 사용하기 편할거에요.

### 흐름
```sh
$ find . -maxdepth 1 -name "src.file" -exec cp {} ./target/ \;
```
이 명령은 "src.file" 이라는 파일을 찾아서, ./target/ 에 복사를 실행하라고 하고 있어요.  
구글에 `쉘 특정 파일 복사하기` 따위로 검색하면 비슷한 표현식들을 많이 찾을 수 있을거에요.

이제 이 명령을 적당한 때에 실행해주면 되는데, '적당한 때'를 찾기 위해서 블로그가 어떤 순서로 deploying되고 있는지를 우선적으로 파악해야 해요. **반자동 쉘 deploying**을 쓰고 있다면, 다음과 같은 순서를 거치는 게 일반적이에요.

1. (수동) 로컬 파일에서 블로그 루트 디렉토리로 이동
1. (수동) `deploy.sh`를 실행
   - `npm run build`를 통해서 블로그 빌드
      - 빌드된 내용은 /dist/ 폴더로
   - 쉘이 /dist/ 폴더
   - /dist/ 폴더에 있는 내용(=블로그 결과물)을 gh-pages 브랜치로 푸쉬

여기서 블로그가 빌드된 후, /dist/ 내용물이 gh-pages로 푸쉬되기 전, find 명령이 실행되면 원하는 파일을 복사시킬 수 있어요. 그래서, 그 위치에 해당 명령을 넣어주면 돼요.

저는, `npm run build`와 `cd docs/.vuepress/dist` 사이에 다음 명령을 위치시켰어요.

```sh
find . -maxdepth 1 -name "sitemap.xml" -exec cp {} ./docs/.vuepress/dist/ \;
```

이 코드는
1. 블로그가 빌드 
2. sitemap.xml 파일을 /dist/ 폴더로 복사
3. 쉘이 gh-pages 브랜치 푸쉬를 위해 /dist/ 폴더로 움직이게끔 해요.

> 실행되는 타이밍을 보고, 목적하는 경로를 어디로 둘지, 파일은 어디에 있는지 고민해야해요.

### find 명령어의 조금 자세한 소개
```sh
$ find . -maxdepth 1 -name "target.file" -exec cp {} ./targetDirectory/ \;
```
제가 예시로 든 이 명령에서 여러 요소들을 볼 수 있어요. 이것들은 각각 다음과 같은 역할을 수행해요.

- `find` : 여기서 소개한 '찾는' 명령이죠.  
- `-maxdepth 1` : 폴더에서만 찾으라는 제한조건. 
   - 기본적으로 `find`는 '모든 하위 디렉토리'까지 포함해서 파일을 탐색.  
- `-name "..."` : 파일 이름 "..."으로 찾겠다는 뜻.  
- `-exec cp{} ~~ \;` : 복사 명령 실행.  

### 수정: 폴더 째로 복사하기
이 `find` 명령어를 HTML 문서를 다루면서 본격적으로 사용하게 되었어요. ***dist*** 폴더(블로그를 빌드한 결과물이 1차로 저장되는 폴더)에 블로그 빌드 후 특정 HTML 예제를 알맞은 위치에 복사하게끔 시켰고, 해당 예제로 링크를 걸어서 예시로 쓴 소스코드의 동작 모습을 보여줄 수 있게 되었죠.  


### 문제상황
:::danger 그런데, 첫 예시를 만들 때에는 파일 한 개만 복사하면 끝이었던 문제가, 여러 개의 예시를 만들고자 하니 상당히 귀찮아지는 거에요.
위에서 예시로 든 find 명령어는 '한 개의 파일'을 복사하고자 한 것이었기 때문에, n의 예제에 대해 n줄의 명령어를 써야 할 판이었죠.
:::

결국, 명령어를 **조금** 수정하게 되었어요.

```sh
$ cp -r CopyThisDirectory /PasteToHere/
```
`find` 명령어는 폴더를 찾는 것도 무리없이 진행하기 때문에 계속 사용하고자 했지만, 복사에 한계가 있어서 훨씬 편한 `cp` 명령을 쓰게 되었어요. 위 예시 코드의 cp 명령은 다음과 같은 명령을 수행해요

1. 현재 경로에서 'CopyThisDirectory' 라는 폴더를 찾아서
1. /PasteToHere/에 복사하죠.

직관적이고, 쉽죠?

:::warning 언젠가는...
문서 카테고리마다 예제 폴더 만드는 게 귀찮아질 날이 분명히 올 것 같아요.  
그 때는 또 어떤 방법을 쓰게 될까요? 예제만 한 폴더에 다 묶어두고 한 번에 복사한 다음, 각 문서에서 서로다른 링크를 타게 되지 않을까요?
:::

## 텍스트 깨짐 문제(인코딩 문제)
vuepress 2로 블로그를 migration 하기 위해 다시 공식 가이드를 따라가는 중, 아주 머리아프고 알 수 없는 오류를 **또** 만났어요.
그리고 언제나와 같이, **역시나** 윈도우라서 문제가 생겼던 것으로 밝혀겼죠.

:::tip 행복-개발을 하고싶나요?
일단 당신 앞에 있는 그 윈도우부터 치워버리고 맥북을 사세요.  
:::

### 문제 싱황
이 문제는, 블로그를 처음 셋팅할 때 주로 일어나고, `dev`나 `build`에 오류는 없지만, 내용 텍스트가 깨져버려요.
예시를 보여드릴게요:
1. 가이드를 따라서 파일 생성

  <img :src="$withBase('images/vuepress/encoding-err-00.png')" style="width:500px;">

2. 정상적으로 생성 완료

  <img :src="$withBase('images/vuepress/encoding-err-01.png')">

3. `build`등을 통해 컴파일 및 렌더링 결과, 텍스트 깨짐

  <img :src="$withBase('images/vuepress/encoding-err-02.png')">

### 상황
[vuepress2 공식 가이드의 Installation](https://vuepress2.netlify.app/guide/getting-started.html#manual-installation)을 보면, 다음과 같은 스텝이 있어요:
```sh
mkdir docs
echo '# Hello VuePress' > docs/README.md
```
- `mkdir docs`는 docs라는 이름의 폴더 생성
- `echo "..." > docs/README.md`는 뒤 경로에 앞 내용 "..."을 채움 

이 명령에는 오류가 있을리 없으니, 정상적으로 파일이 생성되죠.(예시 2번 캡쳐처럼요)  
하지만 실제로 `dev`를 거치면 encoding 에러가 있는, 깨진 텍스트만 보여지게 돼요.  

**이게 만약 한글 텍스트라서 발생되는 문제였다면**, 제가 보여드린 예시처럼 영어로 내용을 작성했을 때에는 일어나지 않아야 할 오류에요. 즉, 영어나 한글이냐가 중요한게 아닌, *근본적인 인코딩 에러*라는 거죠.

### 문제점
문제는, `echo` 명령에 있었어요.  
cmd나 파워쉘과 같은 윈도우 cli의 텍스트 인코딩 방식과 웹 표준이 다르다는 문제죠.  
- 윈도우: **utf-16** 이 표준이고,
- 웹 표준: **utf-8** 이에요.

즉, 윈도우는 `echo` 명령을 내리면 utf-16으로 인코딩 된 텍스트를 파일에 넣어줍니다.  
뷰프레스 프레임워크는 이 텍스트를 웹 표준인 utf-8로 인코딩해서 `.html` 파일을 만들기 때문에, 텍스트가 깨지는 것이죠.

### 해결
VScode를 쓰시나요? 거기서 파일을 만들면 해결돼요.  
:::details 웹 페이지 인코딩 방식을 바꾸는 크롬 플러그인을 설치해도 소용 없어요.
구글에 검색하니 인코딩이 달라서 텍스트가 깨지는 거니, 인코딩 방식을 다르게 해서 읽어내는 플러그인을 사용해보라고 하더라구요.
하지만 이 문제는, 애초에 파워쉘이 utf-16으로 인코딩된 파일을 줘서, 웹팩이 컴파일하면서 텍스트가 깨진거에요.
`build` 후에 `/docs/.vuepress/dist/`에 들어가서 확인해보세요. 아예 .html 파일 내용이 깨진 텍스트로 구성되어 있을거에요.  

즉, 텍스트 깨짐은 프레임워크 단계, `dev`나 `build`과정에서 발생하는 것이지, 브라우저가 파일을 잘못 읽는 게 아니랍니다.
:::